<div>
  <!-- 1. Page Header with a "Back" button -->
  <div class="flex items-center justify-between mb-8">
    <a routerLink="/admin/crop-management" 
       class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-300 flex items-center">
      <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to List
    </a>
    <h1 class="text-3xl font-bold text-gray-800 flex-1 text-center">
      Add New Crop
    </h1>
    <div class="w-[130px]"></div>
  </div>

  <!-- 2. Main Form Container -->
  <form [formGroup]="cropForm" (ngSubmit)="onSubmit()" class="bg-white p-6 md:p-8 rounded-xl shadow-lg space-y-8">

    <!-- Basic Details & Images Section -->
    <fieldset class="border-b-2 border-gray-100 pb-8">
      <legend class="text-xl font-semibold px-2 text-gray-700">1. Basic Details & Images</legend>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-6">
        <input formControlName="name" placeholder="Crop Name *" class="p-3 border rounded-md focus:ring-2 focus:ring-green-500">
        <input formControlName="sowingSeason" placeholder="Sowing Season" class="p-3 border rounded-md">
        <input formControlName="growthDuration" placeholder="Growth Duration" class="p-3 border rounded-md">
      </div>
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block mb-1 font-medium">Cover Image:</label>
          <input type="file" (change)="onFileChange($event, 'coverImage')" class="w-full text-sm">
        </div>
        <div>
          <label class="block mb-1 font-medium">Gallery Images (Multiple):</label>
          <input type="file" (change)="onFileChange($event, 'galleryImages')" class="w-full text-sm" multiple>
        </div>
      </div>
    </fieldset>

    <!-- Growth Stages Section -->
    <fieldset class="border-b-2 border-gray-100 pb-8">
      <legend class="text-xl font-semibold px-2 text-gray-700">2. Growth Stages</legend>
      <div formArrayName="growthStages" class="mt-4 space-y-3">
        <div *ngFor="let stage of growthStages.controls; let i=index" [formGroupName]="i" class="dynamic-entry flex items-center gap-3">
          <input formControlName="stageName" placeholder="Stage Name" class="flex-grow p-2 border rounded-md">
          <input formControlName="durationDays" placeholder="Duration (e.g., 0-25 days)" class="w-1/3 p-2 border rounded-md">
          <button type="button" (click)="removeStage(i)" class="text-red-500 font-bold text-xl hover:text-red-700"> ✕ </button>
        </div>
      </div>
      <button type="button" (click)="addStage()" class="mt-4 bg-gray-200 text-gray-800 text-sm font-semibold py-2 px-4 rounded-md hover:bg-gray-300">+ Add Stage</button>
    </fieldset>

    

    <!-- Disease Management Section -->
    <fieldset class="border-b-2 border-gray-100 pb-8">
      <legend class="text-xl font-semibold px-2 text-gray-700">4. Disease Management</legend>
      <div formArrayName="diseases" class="mt-4 space-y-4">
        <div *ngFor="let disease of diseases.controls; let i=index" [formGroupName]="i" class="dynamic-entry border p-4 rounded-lg bg-gray-50 relative">
          <div class="grid grid-cols-2 gap-4">
            <input formControlName="diseaseName" placeholder="Disease Name" class="p-2 border rounded-md">
            <input formControlName="symptoms" placeholder="Symptoms" class="p-2 border rounded-md">
            <textarea formControlName="causes" placeholder="Causes (comma-separated)" class="p-2 border rounded-md col-span-2"></textarea>
            <input type="file" (change)="onFileChange($event, 'diseaseImage', i)" class="col-span-2 text-sm">
          </div>
          <button type="button" (click)="removeDisease(i)" class="absolute top-3 right-3 text-red-500 font-bold text-xl hover:text-red-700">✕</button>
        </div>
      </div>
      <button type="button" (click)="addDisease()" class="mt-4 bg-gray-200 text-gray-800 text-sm font-semibold py-2 px-4 rounded-md hover:bg-gray-300">+ Add Disease</button>
    </fieldset>


    <!-- Fertilizers Section -->
    <fieldset class="border-b-2 border-gray-100 pb-8">
      <legend class="text-xl font-semibold px-2 text-gray-700">3. Fertilizer Recommendations</legend>
      <div formArrayName="fertilizers" class="mt-4 space-y-3">
          <div *ngFor="let fertilizer of fertilizers.controls; let i=index" [formGroupName]="i" class="dynamic-entry flex items-center gap-3 p-3 bg-gray-50 rounded-md">
              <select formControlName="type" class="p-2 border rounded-md">
                  <option value="chemical">Chemical</option>
                  <option value="organic">Organic</option>
              </select>
              <input formControlName="name" placeholder="Fertilizer Name (e.g., Urea)" class="flex-grow p-2 border rounded-md">
              <input formControlName="quantity" placeholder="Quantity/Acre (e.g., 16kg)" class="w-1/3 p-2 border rounded-md">
              <button type="button" (click)="removeFertilizer(i)" class="text-red-500 font-bold text-xl hover:text-red-700">✕</button>
          </div>
      </div>
      <button type="button" (click)="addFertilizer()" class="mt-4 bg-gray-200 text-gray-800 text-sm font-semibold py-2 px-4 rounded-md hover:bg-gray-300">+ Add Fertilizer</button>
  </fieldset>

    
    <!-- Submit Button -->
    <div class="pt-8 border-t-2 border-gray-100 text-right">
      <button type="submit" [disabled]="cropForm.invalid" class="bg-green-700 text-white font-bold py-3 px-8 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed hover:bg-green-800 transition-all">
        Save Crop
      </button>
    </div>
  </form>
</div>